#### Hash, Crypto

##### Хеширование и шифрование

**Генератор псевдослучайных чисел** — это генератор, который производит случайные байты на основе стартового числа (seed) и математического алгоритма. Зная число seed, можно повторить последовательность следующих байт.

Он не подходит для генерации чувствительных данных, например кук, токенов или ключей.

Основные способы атак — это:
+ Зная алгоритм генератора, математически вывести число seed на основе N чисел из последовательности.
+ Перебрать все последовательности под различными seed. Так как в приложениях в качестве seed обычно выбирается текущее время, это сокращает количество вариантов для перебора.

**Криптостойкий генератор случайных чисел** — это генератор, который производит байты на основе энтропии, порождаемой аппаратно. Такую случайность нельзя предугадать, поэтому нельзя вывести всю последовательность. Этот генератор реализован на уровне операционной системы.

В Go сгенерировать криптостойкие случайные байты можно функцией **rand.Read** из пакета **crypto/rand**. В параметре нужно передать слайс байт ненулевой длины, который будет заполнен случайными байтами. Размер слайса не изменяется. 
Чтобы затем использовать полученный массив байт, например для кук, нужно дополнительно его закодировать. Это можно сделать функцией ***hex.EncodeToString** из пакета **encoding/hex**.

В отличие от генератора псевдослучайных чисел, этот код будет каждый раз при запуске выводить новую последовательность байт.
```Go
package main

import (
    "crypto/rand"
    "encoding/hex"
    "fmt"
)

func main() {
    // определяем слайс нужной длины
    b := make([]byte, 16)
    // записываем байты в массив b
    _, err := rand.Read(b) 
    if err != nil {
        fmt.Printf("error: %v\n", err)
        return
    }

    fmt.Println(hex.EncodeToString(b))
} 
```

Пример:  Написать функцию, которая будет генерировать массив случайных байт. Размер массива передаётся параметром. Функция должна возвращать массив в виде строки в кодировке base64.

```Go
func RandBytes(n int) (string, error) {
    b := make([]byte, n)
    _, err := rand.Read(b)
    if err != nil {
        return ``, err
    }
    return base64.StdEncoding.EncodeToString(b), nil
} 
```

##### Хеширование 
**Хеш-функция** — это функция, которая приводит любую последовательность байт к установленной длине. Длина зависит от используемого алгоритма. Хеш-функции нужны для контроля целостности информации и создания подписи. Если в данных изменится хотя бы один байт, хеш-функция выдаст другой результат.

Хеши бывают криптографические и некриптографические. Некриптографические хеш-функции возвращают слишком короткую последовательность байт. Например, CRC32 и CRC64 возвращают 32- и 64-битные целые числа, что соответствует 4 и 8 байтам. Из-за этого часто возникают коллизии.

***Коллизия*** — это получение одинакового результата хеш-функции при разных входящих данных.
